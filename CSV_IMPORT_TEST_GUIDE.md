# CSV 導入功能測試指南

## 安全測試策略

### 1. 測試前準備
- 使用測試專用的email地址和客戶名稱
- 確保測試數據不會與現有客戶衝突
- 記錄測試開始時間，便於後續清理

### 2. 測試案例設計

#### A. 重複檢測測試
- 測試相同email的重複檢測
- 測試相同name+company組合的重複檢測
- 驗證重複客戶被正確跳過且記錄錯誤

#### B. 城市自動填充測試
- 測試Huelva省份自動填充Huelva城市
- 測試Cádiz省份自動填充Cádiz城市
- 測試notes中包含城市線索的智能填充
- 測試已有城市數據不被覆蓋

#### C. 數據完整性測試
- 測試必填字段驗證
- 測試電話號碼格式化
- 測試省份標準化

### 3. 安全措施

#### 數據隔離
所有測試數據使用特殊標識：
- Email格式：`test-{timestamp}@csvtest.com`
- 公司名稱前綴：`TEST-CSV-`
- Notes包含：`測試數據 - {timestamp}`

#### 清理機制
測試完成後可使用以下方式清理：
1. 利用現有的"Eliminar clo5220 en Notas"功能
2. 手動刪除包含"TEST-CSV-"的客戶
3. 使用timestamp篩選刪除測試時間範圍內的數據

### 4. 測試步驟

1. **第一階段：基礎功能測試**
   - 導入小批量測試數據（3-5條記錄）
   - 驗證基本導入功能正常

2. **第二階段：重複檢測測試**  
   - 重新導入相同數據
   - 確認重複被正確檢測和跳過

3. **第三階段：城市自動填充測試**
   - 測試各種省份和notes組合
   - 驗證城市自動填充邏輯

4. **第四階段：清理測試**
   - 確認測試數據可以安全清理
   - 驗證現有客戶不受影響

### 5. 預期結果

✅ **成功指標：**
- 重複客戶被正確跳過並在錯誤報告中顯示
- 缺失城市根據省份和notes正確填充
- 現有客戶數據完全不受影響
- 測試數據可以完全清理

❌ **失敗指標：**
- 重複客戶被意外創建
- 城市自動填充邏輯錯誤
- 現有客戶數據被修改
- 無法清理測試數據

### 6. 緊急回滾計劃

如果測試期間出現問題：
1. 立即停止導入操作
2. 使用Supabase查詢識別測試數據
3. 手動刪除測試時間範圍內的記錄
4. 檢查現有客戶數據完整性

## 注意事項

- 測試期間建議在非高峰時段進行
- 保持Supabase管理界面打開以便監控
- 測試前先備份重要客戶數據（如果可能）
- 每個測試階段都要驗證結果再進行下一步
