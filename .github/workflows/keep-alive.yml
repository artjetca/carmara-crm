name: Keep Supabase Alive

on:
  schedule:
    # 每 10 分鐘 ping 一次，防止 Supabase 免費方案休眠
    - cron: '*/10 * * * *'
  workflow_dispatch: # 允許手動觸發

jobs:
  ping-supabase:
    runs-on: ubuntu-latest

    steps:
    - name: Ping Supabase REST API
      run: |
        response=$(curl -s -o /dev/null -w "%{http_code}" \
          "https://aotpcnwjjpkzxnhvmcvb.supabase.co/rest/v1/" \
          -H "apikey: ${{ secrets.SUPABASE_ANON_KEY }}" \
          -H "Authorization: Bearer ${{ secrets.SUPABASE_ANON_KEY }}" \
          --max-time 15)
        echo "Supabase response: $response"
        if [ "$response" -ge 200 ] && [ "$response" -lt 400 ]; then
          echo "✅ Supabase is alive"
        else
          echo "⚠️ Supabase returned $response"
        fi

    - name: Ping Netlify site
      run: |
        curl -s -o /dev/null -w "Netlify: %{http_code}\n" \
          https://casmara-charo.netlify.app \
          --max-time 15
