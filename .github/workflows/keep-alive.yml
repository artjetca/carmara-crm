name: Keep Supabase Alive

on:
  schedule:
    # 每 10 分鐘 ping 一次，防止 Supabase 免費方案休眠
    - cron: '*/10 * * * *'
  workflow_dispatch: # 允許手動觸發

jobs:
  ping-supabase:
    runs-on: ubuntu-latest

    steps:
    - name: Ping Supabase REST API
      run: |
        HTTP_CODE=$(curl -s -o /dev/null -w "%{http_code}" \
          "https://aotpcnwjjpkzxnhvmcvb.supabase.co/rest/v1/" \
          -H "apikey: ${{ secrets.SUPABASE_ANON_KEY }}" \
          -H "Authorization: Bearer ${{ secrets.SUPABASE_ANON_KEY }}" \
          --max-time 30 --retry 3 || true)
        echo "Supabase HTTP code: $HTTP_CODE"
        echo "Ping completed at $(date -u)"

    - name: Ping Netlify site
      run: |
        HTTP_CODE=$(curl -s -o /dev/null -w "%{http_code}" \
          https://casmara-charo.netlify.app \
          --max-time 30 --retry 3 || true)
        echo "Netlify HTTP code: $HTTP_CODE"
