<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Geocoding Issue</title>
</head>
<body>
    <h1>测试地理编码问题</h1>
    <div id="results"></div>

    <script>
        // 模拟从路线中看到的客户数据
        const testCustomers = [
            { name: "ALBA MARIN, JUANA", address: "... no se conoce ..." },
            { name: "SANCHEZ FIDEL, CONCEPCION", address: "Calle Sal del Rey, 9, 11540 Jerez de la Frontera, Cádiz, España" },
            { name: "ANA BELEN CAMARGO GUERRERO", address: "..." },
            { name: "MONTIANOS AGUILAR, ROSA ANA", address: "..." }, // 这是第4个定点，跑到海中
            { name: "UNINAK GARCIA, TIFFANY", address: "..." }
        ];

        function analyzeGeocodingIssue() {
            const resultsDiv = document.getElementById('results');
            
            resultsDiv.innerHTML = `
                <h2>分析第4个定点跑到海中的问题</h2>
                <h3>可能原因：</h3>
                <ol>
                    <li><strong>地址数据不完整</strong>：MONTIANOS AGUILAR, ROSA ANA的address字段可能为空或无效</li>
                    <li><strong>地理编码回退逻辑问题</strong>：当主地址失败时，回退到省份级别的坐标</li>
                    <li><strong>Cádiz省份中心点在海上</strong>：如果使用省份地理编码，可能返回海岸线附近的坐标</li>
                    <li><strong>缓存数据错误</strong>：localStorage中保存了错误的坐标</li>
                    <li><strong>Google Maps Directions API问题</strong>：路线计算返回了错误的中间点</li>
                </ol>
                
                <h3>解决方案：</h3>
                <ol>
                    <li>检查客户数据库中的address、city、province字段</li>
                    <li>清除localStorage中的坐标缓存</li>
                    <li>为Cádiz省份设置更准确的默认坐标（避开海域）</li>
                    <li>增加坐标验证逻辑，过滤掉在海中的坐标</li>
                </ol>
                
                <h3>调试步骤：</h3>
                <p>请在浏览器开发者工具中执行以下代码检查localStorage：</p>
                <code>
                    localStorage.getItem('carmara-customer-coords')
                </code>
                
                <p>然后检查MONTIANOS AGUILAR的坐标是否在海中（经度应该在-6.5左右，纬度应该在36.5左右才正常）</p>
            `;
        }

        analyzeGeocodingIssue();
    </script>
</body>
</html>
